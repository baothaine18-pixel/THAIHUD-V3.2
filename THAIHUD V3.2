-- THAIHUD V3.2 - Optimized Version
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

-- Ki·ªÉm tra LocalPlayer ƒë√£ s·∫µn s√†ng ch∆∞a (Best Practice)
local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then return end

-- ========= C·∫•u h√¨nh GUI & Th√¥ng b√°o (Th√™m) =========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "THAIHUD_V3_Optimized"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false
ScreenGui.Enabled = true

local Window = Instance.new("Frame")
Window.Name = "MainWindow"
Window.Size = UDim2.new(0, 450, 0, 600)
Window.Position = UDim2.new(0.3, 0, 0.1, 0)
Window.BackgroundColor3 = Color3.fromRGB(60, 0, 80) -- M√†u t√≠m v≈© tr·ª•
Window.BorderSizePixel = 0
Window.Active = true
Window.Draggable = true
Window.Parent = ScreenGui

-- Corner & Stroke (Th√™m)
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = Window

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Text = "‚ú® THAIHUD V3.2 | Optimized Loader ‚ú®"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.Parent = Window

-- Log/Status Message (Th√™m)
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -20, 0, 20)
StatusLabel.Position = UDim2.new(0, 10, 1, -25) -- ƒê·∫∑t ·ªü ph√≠a d∆∞·ªõi
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
StatusLabel.Text = "Status: Ready."
StatusLabel.Font = Enum.Font.SourceSans
StatusLabel.TextSize = 14
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = Window

local function updateStatus(message, color)
    StatusLabel.Text = "Status: " .. message
    StatusLabel.TextColor3 = color or Color3.fromRGB(255, 255, 0) -- M·∫∑c ƒë·ªãnh v√†ng
end

-- Toggle HUD b·∫±ng ph√≠m K
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.K then
        ScreenGui.Enabled = not ScreenGui.Enabled
    end
end)

-- ========= Script Store (D·ªØ li·ªáu c·ªßa b·∫°n) =========
local ScriptStore = {
    -- Blox Fruits c≈© & m·ªõi
    {name="Gravity Hub", link="https://raw.githubusercontent.com/Dev-GravityHub/BloxFruit/refs/heads/main/Main.lua"},
    {name="W-Azure", link="https://api.luarmor.net/files/v3/loaders/85e904ae1ff30824c1aa007fc7324f8f.lua"},
    {name="BlueX Hub", link="https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"},
    -- ... (Gi·ªØ nguy√™n danh s√°ch c√≤n l·∫°i)
    {name="Master Hub", link="https://raw.githubusercontent.com/KiddoHiru/BloxFruits/main/MasterHub.lua"},
    {name="Astral Hub", link="https://raw.githubusercontent.com/Overgustx2/Main/refs/heads/main/BloxFruits_25.html"},
    {name="Teddy Hub", link="https://raw.githubusercontent.com/Teddyseetink/Haidepzai/refs/heads/main/TeddyHub.lua"},
    {name="Kaitun Script", link="https://raw.githubusercontent.com/shinichi-dz/phucshinsayhi/refs/heads/main/KaitunBloxFruit.lua"},
    {name="Server VIP", link="https://raw.githubusercontent.com/anuragaming1/Meow_gaming/refs/heads/main/Servervip.lua.txt"},
    {name="Ng·ªçc B·ªïng", link="https://raw.githubusercontent.com/ngocbonggaming/script/refs/heads/main/NgocBongVn.lua"},
    {name="Quantum Hub", link="https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua"},
    {name="TyBoy", link="https://raw.githubusercontent.com/TBoyRoblox727/TBoyRobloxYTB/refs/heads/main/AllScriptBF.txt"},
    {name="H√≥d Server", link="https://github.com/WhiteX1208/Scripts/blob/main/HopScript.luau?raw=true"},

    -- Blox Fruits m·ªõi
    {name="Mukuro Hub", link="https://raw.githubusercontent.com/xQuartyx/MukuroHub/main/BloxFruit"},
    {name="Hoho Hub", link="https://raw.githubusercontent.com/acsu123/HohoV2/refs/heads/main/HohoHub.lua"},
    {name="Redz Hub", link="https://raw.githubusercontent.com/RedzHubs/RedzScripts/main/BloxFruit.lua"},
    {name="Phantom Hub", link="https://raw.githubusercontent.com/Phant0mScripts/BloxFruits/main/Loader.lua"},
    {name="Void Hub", link="https://raw.githubusercontent.com/VoidMasterScript/VoidHub/main/Loader.lua"},
    {name="Zen Hub", link="https://raw.githubusercontent.com/ZenHubTeam/BloxFruit/main/Loader.lua"},
    {name="Neva Hub", link="https://raw.githubusercontent.com/NevaHubDEV/Loader/main/NevaBF.lua"},
    {name="FlameX Hub", link="https://raw.githubusercontent.com/FlameXHub/Main/main/Loader.lua"},
    {name="Mango Hub", link="https://raw.githubusercontent.com/MangoHubDev/MangoHub/main/BloxFruits.lua"},
    {name="Xero Hub", link="https://raw.githubusercontent.com/XeroHubTeam/Main/main/BloxFruits.lua"},
    {name="Fusion Hub", link="https://raw.githubusercontent.com/FusionHubDev/Fusion/main/BloxFruit.lua"},
    {name="Delta Hub", link="https://raw.githubusercontent.com/DeltaXHub/DeltaHub/main/BloxFruit.lua"},
    {name="Sakura Hub", link="https://raw.githubusercontent.com/SakuraScripts/Loader/main/SakuraBF.lua"},
    {name="Flame Hub", link="https://raw.githubusercontent.com/FlameScripts/Loader/main/FlameBF.lua"},
    {name="Aureus Hub", link="https://raw.githubusercontent.com/AureusTeam/Loader/main/BloxFruits.lua"},

    -- PvB
    {name="Speed Hub", link="https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua"},

    -- C∆∞·ªõp 1 Brainrots
    {name="Luin L·ªõn", link="http://luminon.top/loader.lua"},
    {name="Luin Nh·ªè", link="http://luminon.top/mini.lua"},
    {name="Vietnam Hub", link="https://raw.githubusercontent.com/replit8173/VietnamHub/refs/heads/main/VietnamseHub.lua"}
}

-- ========= Script List UI (ƒê√£ T·ªëi ∆∞u) =========
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Size = UDim2.new(1, -20, 1, -80) -- Gi·∫£m k√≠ch th∆∞·ªõc ƒë·ªÉ ch·ª´a ch·ªó cho StatusLabel
ScrollFrame.Position = UDim2.new(0, 10, 0, 50)
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, #ScriptStore * 40)
ScrollFrame.ScrollBarThickness = 6
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.Parent = Window

local UIGridLayout = Instance.new("UIGridLayout") -- S·ª≠ d·ª•ng UIGridLayout ƒë·ªÉ qu·∫£n l√Ω v·ªã tr√≠ t·ªët h∆°n
UIGridLayout.CellSize = UDim2.new(1, -10, 0, 36)
UIGridLayout.CellPadding = UDim2.new(0, 0, 0, 4)
UIGridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIGridLayout.Parent = ScrollFrame

for i, s in ipairs(ScriptStore) do
    local Btn = Instance.new("TextButton")
    Btn.Name = "Btn_" .. s.name:gsub(" ", "_") -- ƒê·∫∑t t√™n n√∫t r√µ r√†ng
    Btn.Size = UDim2.new(1, 0, 0, 36) -- ƒê·∫∑t k√≠ch th∆∞·ªõc theo CellSize c·ªßa Layout
    Btn.BackgroundColor3 = Color3.fromRGB(120, 0, 150)
    Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Btn.Font = Enum.Font.GothamBold
    Btn.TextSize = 16
    Btn.Text = s.name
    Btn.Parent = ScrollFrame

    -- Hover Effect (Th√™m)
    Btn.MouseEnter:Connect(function() Btn.BackgroundColor3 = Color3.fromRGB(150, 0, 180) end)
    Btn.MouseLeave:Connect(function() Btn.BackgroundColor3 = Color3.fromRGB(120, 0, 150) end)
    
    Btn.MouseButton1Click:Connect(function()
        updateStatus("Loading " .. s.name .. "...", Color3.fromRGB(255, 255, 0))
        
        -- Th√™m ƒë·ªô tr·ªÖ nh·ªè ƒë·ªÉ tr√°nh spam
        Btn.Active = false
        delay(0.1, function() Btn.Active = true end)

        local ok, code = pcall(function()
            return game:HttpGet(s.link)
        end)
        
        if ok and code and type(code) == "string" and code ~= "" then
            
            local fn, err = loadstring(code)
            
            if fn then
                local success, run_err = pcall(fn)
                if success then
                    updateStatus("‚úÖ Successfully loaded and ran: " .. s.name, Color3.fromRGB(0, 255, 0))
                else
                    -- L·ªói khi script ƒëang ch·∫°y
                    updateStatus("‚ùå RUNTIME ERROR: " .. s.name .. " (" .. tostring(run_err) .. ")", Color3.fromRGB(255, 0, 0))
                    warn("‚ùå RUNTIME ERROR: " .. s.name .. " - " .. tostring(run_err)) 
                end
            else
                -- L·ªói khi loadstring (Script kh√¥ng ph·∫£i Luau h·ª£p l·ªá)
                updateStatus("‚ö†Ô∏è LOADSTRING ERROR: " .. s.name .. " (Not valid Luau code)", Color3.fromRGB(255, 128, 0))
                warn("‚ö†Ô∏è Loadstring error for " .. s.name .. ": " .. tostring(err)) 
            end
        else
            -- L·ªói khi t·∫£i script (URL h·ªèng/Server down)
            updateStatus("üî¥ FETCH FAILED: " .. s.name .. " (URL Down/Empty response)", Color3.fromRGB(255, 0, 0))
            warn("üî¥ Failed to fetch or empty content for: "..s.name..". Status OK: "..tostring(ok))
        end
    end)
end
